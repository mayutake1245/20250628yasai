# 家庭菜園ガイド・交流サイト 基本設計書

## 📋 基本設計書概要

### プロジェクト名
家庭菜園ガイド・交流サイト

### 設計対象
- データモデル設計
- 画面設計
- 画面遷移設計

### 設計方針
- 要件定義書に基づく実装可能な設計
- モダンなWebアプリケーションとしての拡張性
- ユーザビリティを重視したUI/UX設計

---

## 🗄️ データモデル設計

### 1. エンティティ関係図

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   categories    │    │      posts      │    │    favorites    │
│                 │    │                 │    │                 │
│ id (PK)         │◄───┤ category_id (FK)│    │ id (PK)         │
│ name            │    │ id (PK)         │◄───┤ post_id (FK)    │
│ emoji           │    │ name            │    │ user_session_id │
│ color           │    │ title           │    │ created_at      │
│ sort_order      │    │ message         │    └─────────────────┘
│ created_at      │    │ images[]        │
└─────────────────┘    │ created_at      │    ┌─────────────────┐
                       │ updated_at      │    │ notifications   │
                       └─────────────────┘    │                 │
                                              │ id (PK)         │
                                              │ type            │
                                              │ title           │
                                              │ message         │
                                              │ post_id (FK)    │
                                              │ user_session_id │
                                              │ is_read         │
                                              │ created_at      │
                                              └─────────────────┘
```

### 2. テーブル定義

#### 2.1 categories（カテゴリーテーブル）
```sql
CREATE TABLE categories (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(100) NOT NULL,
  emoji VARCHAR(10) NOT NULL,
  color VARCHAR(7) NOT NULL,
  sort_order INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- インデックス
CREATE INDEX idx_categories_sort_order ON categories(sort_order);
```

#### 2.2 posts（投稿テーブル）
```sql
CREATE TABLE posts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(100) NOT NULL,
  title VARCHAR(200) NOT NULL,
  message TEXT NOT NULL,
  category_id UUID NOT NULL REFERENCES categories(id),
  images TEXT[], -- 画像URLの配列
  tags TEXT[], -- タグの配列
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- インデックス
CREATE INDEX idx_posts_category_id ON posts(category_id);
CREATE INDEX idx_posts_created_at ON posts(created_at DESC);
CREATE INDEX idx_posts_name ON posts(name);
```

#### 2.3 favorites（お気に入りテーブル）
```sql
CREATE TABLE favorites (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  post_id UUID NOT NULL REFERENCES posts(id) ON DELETE CASCADE,
  user_session_id VARCHAR(255) NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- インデックス
CREATE INDEX idx_favorites_post_id ON favorites(post_id);
CREATE INDEX idx_favorites_user_session ON favorites(user_session_id);
CREATE UNIQUE INDEX idx_favorites_unique ON favorites(post_id, user_session_id);
```

#### 2.4 notifications（通知テーブル）
```sql
CREATE TABLE notifications (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  type VARCHAR(50) NOT NULL, -- 'reply', 'favorite', 'system'
  title VARCHAR(200) NOT NULL,
  message TEXT NOT NULL,
  post_id UUID REFERENCES posts(id) ON DELETE CASCADE,
  user_session_id VARCHAR(255) NOT NULL,
  is_read BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- インデックス
CREATE INDEX idx_notifications_user_session ON notifications(user_session_id);
CREATE INDEX idx_notifications_is_read ON notifications(is_read);
CREATE INDEX idx_notifications_created_at ON notifications(created_at DESC);
```

### 3. 初期データ

#### 3.1 categories テーブルの初期データ
```sql
INSERT INTO categories (name, emoji, color, sort_order) VALUES
('トマト', '🍅', '#FF6B6B', 1),
('にんじん', '🥕', '#FFA726', 2),
('レタス', '🥬', '#66BB6A', 3),
('きゅうり', '🥒', '#4CAF50', 4),
('ブロッコリー', '🥦', '#8BC34A', 5),
('ピーマン', '🫑', '#FF9800', 6),
('たまねぎ', '🧅', '#FF5722', 7),
('じゃがいも', '🥔', '#795548', 8),
('小松菜', '🥬', '#4CAF50', 9),
('ハーブ系', '🌿', '#8BC34A', 10),
('その他', '🌱', '#9E9E9E', 11);
```

### 4. データ型定義（TypeScript）

#### 4.1 基本型定義
```typescript
// カテゴリー型
interface Category {
  id: string;
  name: string;
  emoji: string;
  color: string;
  sort_order: number;
  created_at: string;
}

// 投稿型
interface Post {
  id: string;
  name: string;
  title: string;
  message: string;
  category_id: string;
  category?: Category;
  images: string[];
  tags: string[];
  created_at: string;
  updated_at: string;
}

// お気に入り型
interface Favorite {
  id: string;
  post_id: string;
  post?: Post;
  user_session_id: string;
  created_at: string;
}

// 通知型
interface Notification {
  id: string;
  type: 'reply' | 'favorite' | 'system';
  title: string;
  message: string;
  post_id?: string;
  post?: Post;
  user_session_id: string;
  is_read: boolean;
  created_at: string;
}

// 投稿作成・更新用型
interface CreatePostData {
  name: string;
  title: string;
  message: string;
  category_id: string;
  images?: File[];
  tags?: string[];
}

interface UpdatePostData extends Partial<CreatePostData> {
  id: string;
}
```

---

## 🎨 画面設計

### 1. 画面一覧

| 画面名 | パス | 機能概要 | レスポンシブ対応 |
|--------|------|----------|------------------|
| トップページ | / | ガイド概要・統計・新着投稿 | ○ |
| ガイドページ | /guide | 家庭菜園ガイド | ○ |
| 掲示板一覧 | /posts | 投稿一覧・検索・ソート | ○ |
| 投稿詳細 | /posts/[id] | 投稿詳細・編集・削除 | ○ |
| 投稿作成 | /posts/create | 新規投稿作成 | ○ |
| 投稿編集 | /posts/[id]/edit | 投稿編集 | ○ |
| お気に入り | /favorites | お気に入り一覧 | ○ |
| 通知一覧 | /notifications | 通知一覧 | ○ |

### 2. 画面詳細設計

#### 2.1 トップページ (/)
```
┌─────────────────────────────────────────────────────────────┐
│ Header: ロゴ・ナビゲーション・通知アイコン・お気に入りアイコン │
├─────────────────────────────────────────────────────────────┤
│ ヒーローセクション                                          │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 家庭菜園ガイド・交流サイト                               │ │
│ │ 初心者でも安心！野菜の育て方を学ぼう                    │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ 統計セクション                                              │
│ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────┐ │
│ │ 総投稿数    │ │ 今日の投稿  │ │ 参加者数    │ │ 人気   │ │
│ │ 1,234件     │ │ 12件        │ │ 567人       │ │ トマト │ │
│ └─────────────┘ └─────────────┘ └─────────────┘ └─────────┘ │
├─────────────────────────────────────────────────────────────┤
│ ガイドダイジェスト                                          │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 🌱 家庭菜園の基本                                        │ │
│ │ 日当たり・水やり・土づくりのポイントを解説              │ │
│ │ [詳細を見る]                                             │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ 新着投稿セクション                                          │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 📝 新着投稿                                              │ │
│ │ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────┐ │ │
│ │ │ 投稿1   │ │ 投稿2   │ │ 投稿3   │ │ 投稿4   │ │ ... │ │ │
│ │ └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────┘ │ │
│ │ [すべて見る]                                             │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ Footer: リンク・コピーライト                               │
└─────────────────────────────────────────────────────────────┘
```

#### 2.2 ガイドページ (/guide)
```
┌─────────────────────────────────────────────────────────────┐
│ Header: ロゴ・ナビゲーション・通知アイコン・お気に入りアイコン │
├─────────────────────────────────────────────────────────────┤
│ ガイドタイトル                                              │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 🌱 初心者向け家庭菜園ガイド                              │ │
│ │ 初めての方でも安心！野菜の育て方をステップバイステップで │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ タブナビゲーション                                          │
│ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ │
│ │基本知識 │ │ トマト  │ │ にんじん│ │ レタス  │ │コツ・   │ │
│ │         │ │         │ │         │ │         │ │注意点   │ │
│ └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ │
├─────────────────────────────────────────────────────────────┤
│ タブコンテンツ（基本知識タブ例）                            │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 🌱 家庭菜園の基本                                        │ │
│ │ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────┐ │ │
│ │ │ 🌞 日当たり │ │ 💧 水やり   │ │ 🌱 土づくり │ │ 🌡️ │ │ │
│ │ │ 1日6時間以上│ │ 土が乾いたら│ │ 培養土使用  │ │温度 │ │ │
│ │ │ 日光が必要  │ │ 水をあげる  │ │ 堆肥を混ぜる│ │管理 │ │ │
│ │ │ └─────────────┘ └─────────────┘ └─────────────┘ └─────┘ │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ Footer: リンク・コピーライト                               │
└─────────────────────────────────────────────────────────────┘
```

#### 2.3 掲示板一覧ページ (/posts)
```
┌─────────────────────────────────────────────────────────────┐
│ Header: ロゴ・ナビゲーション・通知アイコン・お気に入りアイコン │
├─────────────────────────────────────────────────────────────┤
│ ページタイトル・検索・フィルタ                              │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 📝 掲示板一覧                                            │ │
│ │ ┌─────────────┐ ┌─────────┐ ┌─────────┐ ┌─────────────┐ │ │
│ │ │ 🔍 検索     │ │ カテゴリー│ │ ソート │ │ [投稿する]  │ │ │
│ │ └─────────────┘ └─────────┘ └─────────┘ └─────────────┘ │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ 投稿一覧                                                    │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ ┌─────────────┐ ┌─────────────────────────────────────┐ │ │
│ │ │ 🍅 トマト   │ │ トマトの育て方について               │ │ │
│ │ │             │ │ 初めてトマトを育てるのですが、       │ │ │
│ │ │ [画像]      │ │ 水やりの頻度はどのくらいが...       │ │ │
│ │ │             │ │                                     │ │ │
│ │ │ 投稿者: 田中│ │ 投稿日: 2024-12-28                  │ │
│ │ │ お気に入り: ❤️│ │ [詳細] [編集] [削除]                │ │
│ │ └─────────────┘ └─────────────────────────────────────┘ │ │
│ │ ┌─────────────┐ ┌─────────────────────────────────────┐ │ │
│ │ │ 🥕 にんじん │ │ にんじんの間引きについて             │ │ │
│ │ │             │ │ にんじんの間引きのタイミングを...   │ │ │
│ │ │ [画像]      │ │                                     │ │
│ │ │             │ │ 投稿者: 名無し                       │ │
│ │ │ 投稿者: 名無し│ │ 投稿日: 2024-12-27                  │ │
│ │ │ お気に入り: 🤍│ │ [詳細] [編集] [削除]                │ │
│ │ └─────────────┘ └─────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ ページネーション                                            │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ [前へ] 1 2 3 4 5 [次へ]                                  │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ Footer: リンク・コピーライト                               │
└─────────────────────────────────────────────────────────────┘
```

#### 2.4 投稿詳細ページ (/posts/[id])
```
┌─────────────────────────────────────────────────────────────┐
│ Header: ロゴ・ナビゲーション・通知アイコン・お気に入りアイコン │
├─────────────────────────────────────────────────────────────┤
│ 投稿詳細                                                    │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 🍅 トマトの育て方について                                │ │
│ │ ┌─────────────────────────────────────────────────────┐ │ │
│ │ │ 投稿者: 田中 | 投稿日: 2024-12-28 | カテゴリー: トマト│ │ │
│ │ └─────────────────────────────────────────────────────┘ │ │
│ │                                                         │ │
│ │ 初めてトマトを育てるのですが、水やりの頻度はどのくらいが │ │
│ │ 適切でしょうか？また、支柱はいつ立てればよいですか？    │ │
│ │                                                         │ │
│ │ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────┐ │ │
│ │ │ [画像1]     │ │ [画像2]     │ │ [画像3]     │ │ ... │ │ │
│ │ │ 拡大表示    │ │ 拡大表示    │ │ 拡大表示    │ │     │ │ │
│ │ └─────────────┘ └─────────────┘ └─────────────┘ └─────┘ │ │
│ │                                                         │ │
│ │ ┌─────────────────────────────────────────────────────┐ │ │
│ │ │ [❤️ お気に入り] [✏️ 編集] [🗑️ 削除] [← 戻る]        │ │ │
│ │ └─────────────────────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ 関連投稿                                                    │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 📝 関連投稿                                              │ │
│ │ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────┐ │ │
│ │ │ 関連1   │ │ 関連2   │ │ 関連3   │ │ 関連4   │ │ ... │ │ │
│ │ └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────┘ │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ Footer: リンク・コピーライト                               │
└─────────────────────────────────────────────────────────────┘
```

#### 2.5 投稿作成ページ (/posts/create)
```
┌─────────────────────────────────────────────────────────────┐
│ Header: ロゴ・ナビゲーション・通知アイコン・お気に入りアイコン │
├─────────────────────────────────────────────────────────────┤
│ 投稿作成フォーム                                            │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 📝 新しい投稿                                            │ │
│ │                                                         │ │
│ │ ┌─────────────────────────────────────────────────────┐ │ │
│ │ │ お名前 *                                             │ │
│ │ │ [________________]                                   │ │
│ │ └─────────────────────────────────────────────────────┘ │ │
│ │                                                         │ │
│ │ ┌─────────────────────────────────────────────────────┐ │ │
│ │ │ タイトル *                                           │ │
│ │ │ [________________]                                   │ │
│ │ └─────────────────────────────────────────────────────┘ │ │
│ │                                                         │ │
│ │ ┌─────────────────────────────────────────────────────┐ │ │
│ │ │ カテゴリー *                                         │ │
│ │ │ [🍅 トマト ▼]                                       │ │
│ │ └─────────────────────────────────────────────────────┘ │ │
│ │                                                         │ │
│ │ ┌─────────────────────────────────────────────────────┐ │ │
│ │ │ メッセージ *                                         │ │
│ │ │ [                                                ]   │ │
│ │ │ [                                                ]   │ │
│ │ │ [                                                ]   │ │
│ │ │ [                                                ]   │ │
│ │ └─────────────────────────────────────────────────────┘ │ │
│ │                                                         │ │
│ │ ┌─────────────────────────────────────────────────────┐ │ │
│ │ │ 画像（最大5枚、50MBまで）                            │ │
│ │ │ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐     │ │
│ │ │ │ [画像1]     │ │ [画像2]     │ │ [+ 追加]    │     │ │
│ │ │ │ [削除]      │ │ [削除]      │ │             │     │ │
│ │ │ └─────────────┘ └─────────────┘ └─────────────┘     │ │
│ │ └─────────────────────────────────────────────────────┘ │ │
│ │                                                         │ │
│ │ ┌─────────────────────────────────────────────────────┐ │ │
│ │ │ [投稿する] [クリア] [キャンセル]                     │ │ │
│ │ └─────────────────────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ Footer: リンク・コピーライト                               │
└─────────────────────────────────────────────────────────────┘
```

#### 2.6 お気に入りページ (/favorites)
```
┌─────────────────────────────────────────────────────────────┐
│ Header: ロゴ・ナビゲーション・通知アイコン・お気に入りアイコン │
├─────────────────────────────────────────────────────────────┤
│ お気に入り一覧                                              │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ ❤️ お気に入り投稿                                        │ │
│ │ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────┐ │ │
│ │ │ ソート  │ │ 検索    │ │ フィルタ│ │ 全削除  │ │     │ │ │
│ │ └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────┘ │ │
│ │                                                         │ │
│ │ ┌─────────────┐ ┌─────────────────────────────────────┐ │ │
│ │ │ 🍅 トマト   │ │ トマトの育て方について               │ │ │
│ │ │             │ │ 初めてトマトを育てるのですが、       │ │ │
│ │ │ [画像]      │ │ 水やりの頻度はどのくらいが...       │ │ │
│ │ │             │ │                                     │ │ │
│ │ │ 投稿者: 田中│ │ 投稿日: 2024-12-28                  │ │ │
│ │ │ 登録日: 2024-12-28│ [詳細] [削除]                      │ │ │
│ │ └─────────────┘ └─────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ Footer: リンク・コピーライト                               │
└─────────────────────────────────────────────────────────────┘
```

#### 2.7 通知一覧ページ (/notifications)
```
┌─────────────────────────────────────────────────────────────┐
│ Header: ロゴ・ナビゲーション・通知アイコン・お気に入りアイコン │
├─────────────────────────────────────────────────────────────┤
│ 通知一覧                                                    │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 🔔 通知一覧                                              │ │
│ │ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────┐ │ │
│ │ │ すべて  │ │ 未読    │ │ 既読    │ │ 全既読  │ │     │ │ │
│ │ └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────┘ │ │
│ │                                                         │ │
│ │ ┌─────────────────────────────────────────────────────┐ │ │
│ │ │ 🔴 名無しさんから回答がありました                   │ │
│ │ │ 投稿「トマトの育て方について」に新しい回答が...     │ │
│ │ │ 2024-12-28 14:30                                    │ │
│ │ └─────────────────────────────────────────────────────┘ │ │
│ │                                                         │ │
│ │ ┌─────────────────────────────────────────────────────┐ │ │
│ │ │ ⚪ システム通知                                       │ │
│ │ │ 新しい機能が追加されました                           │ │
│ │ │ 2024-12-27 10:00                                    │ │
│ │ └─────────────────────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ Footer: リンク・コピーライト                               │
└─────────────────────────────────────────────────────────────┘
```

### 3. レスポンシブデザイン対応

#### 3.1 ブレークポイント
- **デスクトップ**: 1200px以上
- **タブレット**: 768px - 1199px
- **モバイル**: 767px以下

#### 3.2 モバイル対応例（掲示板一覧）
```
┌─────────────────────────────────────┐
│ Header: ロゴ・メニューアイコン       │
├─────────────────────────────────────┤
│ 📝 掲示板一覧                        │
│ ┌─────────────────────────────────┐ │
│ │ 🔍 検索                         │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ カテゴリー: [🍅 トマト ▼]       │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ ソート: [新着順 ▼]              │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ [投稿する]                      │ │
│ └─────────────────────────────────┘ │
├─────────────────────────────────────┤
│ 🍅 トマトの育て方について            │
│ 初めてトマトを育てるのですが...      │
│ 投稿者: 田中 | 2024-12-28           │
│ [詳細] [❤️]                        │
├─────────────────────────────────────┤
│ 🥕 にんじんの間引きについて          │
│ にんじんの間引きのタイミングを...    │
│ 投稿者: 名無し | 2024-12-27         │
│ [詳細] [🤍]                        │
├─────────────────────────────────────┤
│ [前へ] 1 2 3 [次へ]                 │
├─────────────────────────────────────┤
│ Footer: リンク・コピーライト       │
└─────────────────────────────────────┘
```

---

## 🔄 画面遷移設計

### 1. 画面遷移図

```
                    ┌─────────────┐
                    │   トップ    │
                    │     /       │
                    └─────┬───────┘
                          │
        ┌─────────────────┼─────────────────┐
        │                 │                 │
    ┌───▼───┐         ┌───▼───┐         ┌───▼───┐
    │ ガイド │         │掲示板 │         │お気入 │
    │ /guide│         │ /posts│         │ /favo │
    └───┬───┘         └───┬───┘         └───┬───┘
        │                 │                 │
        │             ┌───▼───┐             │
        │             │投稿詳細│             │
        │             │/posts/│             │
        │             │ [id]  │             │
        │             └───┬───┘             │
        │                 │                 │
        │             ┌───▼───┐             │
        │             │投稿作成│             │
        │             │/create│             │
        │             └───────┘             │
        │                 │                 │
        │             ┌───▼───┐             │
        │             │投稿編集│             │
        │             │/edit  │             │
        │             └───────┘             │
        │                 │                 │
    ┌───▼───┐         ┌───▼───┐         ┌───▼───┐
    │通知一覧│         │通知一覧│         │通知一覧│
    │/notif │         │/notif │         │/notif │
    └───────┘         └───────┘         └───────┘
```

### 2. 遷移パターン詳細

#### 2.1 ナビゲーション遷移
| 遷移元 | 遷移先 | 遷移方法 | 条件 |
|--------|--------|----------|------|
| トップ | ガイド | ナビゲーション | なし |
| トップ | 掲示板 | ナビゲーション | なし |
| トップ | お気に入り | ナビゲーション | なし |
| トップ | 通知 | ナビゲーション | なし |
| ガイド | トップ | ナビゲーション | なし |
| ガイド | 掲示板 | ナビゲーション | なし |
| 掲示板 | トップ | ナビゲーション | なし |
| 掲示板 | 投稿詳細 | 投稿クリック | なし |
| 掲示板 | 投稿作成 | 投稿ボタン | なし |

#### 2.2 投稿関連遷移
| 遷移元 | 遷移先 | 遷移方法 | 条件 |
|--------|--------|----------|------|
| 掲示板一覧 | 投稿詳細 | 投稿タイトルクリック | なし |
| 投稿詳細 | 掲示板一覧 | 戻るボタン | なし |
| 投稿詳細 | 投稿編集 | 編集ボタン | なし |
| 投稿詳細 | 掲示板一覧 | 削除ボタン | 確認ダイアログ |
| 掲示板一覧 | 投稿作成 | 投稿ボタン | なし |
| 投稿作成 | 掲示板一覧 | 投稿完了 | バリデーション成功 |
| 投稿作成 | 投稿作成 | 投稿失敗 | バリデーションエラー |
| 投稿編集 | 投稿詳細 | 更新完了 | バリデーション成功 |
| 投稿編集 | 投稿編集 | 更新失敗 | バリデーションエラー |

#### 2.3 お気に入り関連遷移
| 遷移元 | 遷移先 | 遷移方法 | 条件 |
|--------|--------|----------|------|
| 投稿詳細 | お気に入り | お気に入りボタン | なし |
| お気に入り | 投稿詳細 | 投稿タイトルクリック | なし |
| お気に入り | お気に入り | お気に入り削除 | 確認ダイアログ |

#### 2.4 通知関連遷移
| 遷移元 | 遷移先 | 遷移方法 | 条件 |
|--------|--------|----------|------|
| 全ページ | 通知一覧 | 通知アイコンクリック | なし |
| 通知一覧 | 投稿詳細 | 通知クリック | 投稿関連通知 |
| 通知一覧 | 通知一覧 | 既読ボタン | なし |

### 3. 遷移時の状態管理

#### 3.1 ページ遷移時の処理
```typescript
// ページ遷移時の共通処理
const handlePageTransition = (to: string) => {
  // 1. ローディング状態の設定
  setLoading(true);
  
  // 2. フォームデータの保存（編集中の場合）
  if (isEditing) {
    saveFormData();
  }
  
  // 3. スクロール位置のリセット
  window.scrollTo(0, 0);
  
  // 4. ページ遷移
  router.push(to);
};

// 投稿詳細への遷移
const handlePostClick = (postId: string) => {
  // 1. 投稿データのプリロード
  prefetchPost(postId);
  
  // 2. 遷移
  handlePageTransition(`/posts/${postId}`);
};
```

#### 3.2 フォーム遷移時の処理
```typescript
// 投稿作成・編集フォームの遷移
const handleFormSubmit = async (data: CreatePostData) => {
  try {
    // 1. バリデーション
    const validatedData = await validateForm(data);
    
    // 2. 画像アップロード
    const imageUrls = await uploadImages(data.images);
    
    // 3. 投稿作成・更新
    const result = await createPost({ ...validatedData, images: imageUrls });
    
    // 4. 成功通知
    toast.success('投稿が完了しました');
    
    // 5. 遷移
    handlePageTransition('/posts');
    
  } catch (error) {
    // エラー通知
    toast.error('投稿に失敗しました');
  }
};
```

### 4. エラーハンドリング

#### 4.1 404エラー
- 存在しない投稿IDでアクセス
- 存在しないページへのアクセス
- 対応: 404ページへの遷移

#### 4.2 バリデーションエラー
- フォーム入力エラー
- 対応: エラーメッセージ表示、遷移しない

#### 4.3 ネットワークエラー
- API通信エラー
- 対応: エラー通知、リトライ機能

### 5. ユーザビリティ考慮事項

#### 5.1 戻るボタン対応
- ブラウザの戻るボタンで適切なページに遷移
- フォーム編集中は確認ダイアログ表示

#### 5.2 ページリロード対応
- ページリロード時に適切な状態を復元
- フォームデータの保持

#### 5.3 モバイル対応
- タッチ操作に最適化された遷移
- スワイプジェスチャーの対応

---

## 🔧 技術実装詳細

### 1. Next.js App Router構成
```
app/
├── layout.tsx              # 共通レイアウト
├── page.tsx                # トップページ
├── globals.css             # グローバルスタイル
├── guide/
│   └── page.tsx            # ガイドページ
├── posts/
│   ├── page.tsx            # 掲示板一覧
│   ├── create/
│   │   └── page.tsx        # 投稿作成
│   └── [id]/
│       ├── page.tsx        # 投稿詳細
│       └── edit/
│           └── page.tsx    # 投稿編集
├── favorites/
│   └── page.tsx            # お気に入り
├── notifications/
│   └── page.tsx            # 通知一覧
└── api/
    ├── posts/
    │   ├── route.ts        # 投稿API
    │   └── [id]/
    │       └── route.ts    # 投稿詳細API
    ├── categories/
    │   └── route.ts        # カテゴリーAPI
    ├── favorites/
    │   └── route.ts        # お気に入りAPI
    └── notifications/
        └── route.ts        # 通知API
```

### 2. 状態管理（Zustand）
```typescript
interface AppState {
  // 投稿関連
  posts: Post[];
  currentPost: Post | null;
  categories: Category[];
  
  // お気に入り関連
  favorites: string[];
  
  // 通知関連
  notifications: Notification[];
  unreadCount: number;
  
  // UI状態
  isLoading: boolean;
  currentTab: string;
  searchQuery: string;
  selectedCategory: string | null;
  
  // アクション
  fetchPosts: () => Promise<void>;
  createPost: (post: CreatePostData) => Promise<void>;
  updatePost: (id: string, post: UpdatePostData) => Promise<void>;
  deletePost: (id: string) => Promise<void>;
  toggleFavorite: (postId: string) => Promise<void>;
  markNotificationAsRead: (id: string) => Promise<void>;
}
```

### 3. API設計
```typescript
// 投稿API
interface PostAPI {
  // 投稿一覧取得
  GET /api/posts?category=&search=&sort=&page=&limit=
  Response: { posts: Post[], total: number, page: number }
  
  // 投稿作成
  POST /api/posts
  Body: CreatePostData
  Response: { post: Post }
  
  // 投稿詳細取得
  GET /api/posts/[id]
  Response: { post: Post }
  
  // 投稿更新
  PUT /api/posts/[id]
  Body: UpdatePostData
  Response: { post: Post }
  
  // 投稿削除
  DELETE /api/posts/[id]
  Response: { success: boolean }
}

// カテゴリーAPI
interface CategoryAPI {
  // カテゴリー一覧取得
  GET /api/categories
  Response: { categories: Category[] }
}

// お気に入りAPI
interface FavoriteAPI {
  // お気に入り一覧取得
  GET /api/favorites
  Response: { favorites: Favorite[] }
  
  // お気に入り追加
  POST /api/favorites
  Body: { post_id: string }
  Response: { favorite: Favorite }
  
  // お気に入り削除
  DELETE /api/favorites/[id]
  Response: { success: boolean }
}

// 通知API
interface NotificationAPI {
  // 通知一覧取得
  GET /api/notifications
  Response: { notifications: Notification[], unreadCount: number }
  
  // 通知既読
  PUT /api/notifications/[id]/read
  Response: { success: boolean }
}
```

---

## 📱 PWA設計

### 1. manifest.json
```json
{
  "name": "家庭菜園ガイド・交流サイト",
  "short_name": "家庭菜園",
  "description": "初心者向け家庭菜園ガイドと交流サイト",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#4CAF50",
  "orientation": "portrait-primary",
  "icons": [
    {
      "src": "/icon-192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icon-512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "any maskable"
    }
  ]
}
```

### 2. Service Worker
```typescript
// キャッシュ戦略
const CACHE_NAME = 'garden-guide-v1';
const STATIC_CACHE = 'static-v1';
const DYNAMIC_CACHE = 'dynamic-v1';

// キャッシュ対象
const STATIC_ASSETS = [
  '/',
  '/guide',
  '/posts',
  '/favorites',
  '/notifications',
  '/manifest.json',
  '/icon-192.png',
  '/icon-512.png'
];

// インストール時
self.addEventListener('install', (event) => {
  event.waitUntil(
    caches.open(STATIC_CACHE).then((cache) => {
      return cache.addAll(STATIC_ASSETS);
    })
  );
});

// フェッチ時
self.addEventListener('fetch', (event) => {
  // ネットワークファースト戦略
  event.respondWith(
    fetch(event.request)
      .then((response) => {
        // 成功時はキャッシュに保存
        if (response.status === 200) {
          const responseClone = response.clone();
          caches.open(DYNAMIC_CACHE).then((cache) => {
            cache.put(event.request, responseClone);
          });
        }
        return response;
      })
      .catch(() => {
        // 失敗時はキャッシュから取得
        return caches.match(event.request);
      })
  );
});
```

---

## 🧪 テスト設計

### 1. テスト戦略
- **Unit Test**: コンポーネント・関数の単体テスト
- **Integration Test**: API・データベース連携テスト
- **E2E Test**: ユーザー操作フローのテスト
- **Visual Test**: UI表示のテスト

### 2. テストカバレッジ目標
- **全体**: 80%以上
- **重要機能**: 100%
- **API**: 90%以上

### 3. テストツール
- **Jest**: ユニットテスト
- **React Testing Library**: コンポーネントテスト
- **Playwright**: E2Eテスト
- **MSW**: APIモック

---

## 📈 パフォーマンス設計

### 1. 最適化戦略
- **画像最適化**: Next.js Image component
- **コード分割**: 動的インポート
- **キャッシュ**: TanStack Query + SWR
- **CDN**: Vercel Edge Network

### 2. 監視項目
- **Core Web Vitals**: LCP, FID, CLS
- **First Contentful Paint**: 1.5秒以内
- **Largest Contentful Paint**: 2.5秒以内
- **Cumulative Layout Shift**: 0.1以下

---

**作成日**: 2024年12月28日  
**作成者**: AI Assistant  
**バージョン**: 1.0.0 